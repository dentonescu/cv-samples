######################################
# cv-samples: docker-compose.yml
######################################

services:
  slideshow-server:
    build:
      context: .
      dockerfile: slideshow-server/Dockerfile
    ports:
      - "8083:8080"
    volumes:
      - ./slideshow-server/publicdomainpictures.net:/media:ro
    restart: unless-stopped
  wifiequ-backend:
    build:
      context: .
      dockerfile: wifiequ/Dockerfile
    environment:
      WFQ_MOCK: "1"
      WFQ_IFACE: "wlan0"
      WFQ_ACCESS_TOKEN: "wfq-demo-token-please-change"
    ports:
      - "8084:8080"
    restart: unless-stopped
  wifiequ-frontend:
    build:
      context: ./wifiequ/web-angular
      dockerfile: Dockerfile
    environment:
      WFQ_BACKEND_URL: "http://wifiequ-backend:8080"
      WFQ_FRONTEND_PORT: "80"
      WFQ_STATS_KEY: "wfq-demo-token-please-change"
    ports:
      - "8085:80"
    depends_on:
      - wifiequ-backend
    restart: unless-stopped
  heapmonj-backend:
    build:
      context: .
      dockerfile: heapmonj/backend/Dockerfile
    ports:
      - "8081:8080"
    volumes:
      - ./heapmonj/backend/heapmonj/data:/opt/heapmonj/data
    restart: unless-stopped
  heapmonj-frontend:
    build:
      context: .
      dockerfile: heapmonj/frontend/Dockerfile
    ports:
      - "8082:80"
    depends_on:
      - heapmonj-backend
    restart: unless-stopped
  stack-index:
    image: nginx:1.27-alpine
    volumes:
      - ./docker/index:/usr/share/nginx/html:ro
    ports:
      - "8080:80"
    depends_on:
      - slideshow-server
      - wifiequ-backend
      - heapmonj-backend
      - heapmonj-frontend
    restart: unless-stopped
