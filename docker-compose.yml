######################################
# cv-samples: docker-compose.yml
######################################

services:
  heapmonj-backend:
    build:
      context: .
      dockerfile: heapmonj/backend/Dockerfile
    ports:
      - "8081:8080"
    volumes:
      - ./heapmonj/backend/heapmonj/data:/opt/heapmonj/data
    restart: unless-stopped
  heapmonj-frontend:
    build:
      context: .
      dockerfile: heapmonj/frontend/Dockerfile
    ports:
      - "8082:80"
    depends_on:
      - heapmonj-backend
    restart: unless-stopped
  null-cipher:
    build:
      context: ./null-cipher
      dockerfile: Dockerfile
    ports:
      - "8083:80"
    restart: unless-stopped
  pkixwebadm:
    build:
      context: .
      dockerfile: pkixwebadm/Dockerfile
    ports:
      - "8084:8080"
    restart: unless-stopped
  pwa-llm-poc-backend:
    build:
      context: ./pwa-llm-poc
      dockerfile: backend/Dockerfile
    environment:
      OLLAMA_URL: "http://host.docker.internal:11434"
      PWA_LLM_BIND_ADDRESS: "0.0.0.0"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "8085:5000"
    restart: unless-stopped
  pwa-llm-poc-frontend:
    build:
      context: ./pwa-llm-poc/frontend/llm-spa
      dockerfile: Dockerfile
    ports:
      - "8086:80"
    depends_on:
      - pwa-llm-poc-backend
    restart: unless-stopped
  slideshow-server:
    build:
      context: .
      dockerfile: slideshow-server/Dockerfile
    ports:
      - "8087:8080"
    volumes:
      - ./slideshow-server/publicdomainpictures.net:/media:ro
    restart: unless-stopped
  stack-index:
    image: nginx:1.27-alpine
    volumes:
      - ./docker/index:/usr/share/nginx/html:ro
    ports:
      - "8080:80"
    depends_on:
      - heapmonj-backend
      - heapmonj-frontend
      - null-cipher
      - pkixwebadm
      - pwa-llm-poc-backend
      - pwa-llm-poc-frontend
      - slideshow-server
      - triangle-peg-game-react
      - wifiequ-backend
      - wifiequ-frontend
    restart: unless-stopped
  triangle-peg-game-react:
    build:
      context: ./triangle-peg-game-react
      dockerfile: Dockerfile
    ports:
      - "8088:80"
    restart: unless-stopped
  wifiequ-backend:
    build:
      context: .
      dockerfile: wifiequ/Dockerfile
    environment:
      WFQ_MOCK: "1"
      WFQ_IFACE: "wlan0"
      WFQ_ACCESS_TOKEN: "wfq-demo-token-please-change"
    ports:
      - "8089:8080"
    restart: unless-stopped
  wifiequ-frontend:
    build:
      context: ./wifiequ/web-angular
      dockerfile: Dockerfile
    environment:
      WFQ_BACKEND_URL: "http://wifiequ-backend:8080"
      WFQ_FRONTEND_PORT: "80"
      WFQ_STATS_KEY: "wfq-demo-token-please-change"
    ports:
      - "8090:80"
    depends_on:
      - wifiequ-backend
    restart: unless-stopped
